# æ ¸å¿ƒåŠŸèƒ½å®ç°è¯´æ˜

## âœ… å·²å®Œæˆçš„æ ¸å¿ƒåŠŸèƒ½

### 1. **æµ‹è¯•ç”¨ä¾‹æ‰§è¡Œå¼•æ“** (`backend/apps/testcases/executor.py`)

å®ç°äº†å®Œæ•´çš„æµ‹è¯•ç”¨ä¾‹æ‰§è¡Œå¼•æ“ï¼Œæ”¯æŒï¼š

#### ğŸ”§ åŠŸèƒ½ç‰¹æ€§
- **HTTP è¯·æ±‚å‘é€**ï¼šæ”¯æŒæ‰€æœ‰ HTTP æ–¹æ³•ï¼ˆGET/POST/PUT/DELETE/PATCHç­‰ï¼‰
- **URL æ„å»º**ï¼šè‡ªåŠ¨ç»„åˆç¯å¢ƒåŸºç¡€URLå’Œæ¥å£è·¯å¾„
- **è¯·æ±‚å¤´å¤„ç†**ï¼šåˆå¹¶ç¯å¢ƒé»˜è®¤è¯·æ±‚å¤´å’ŒAPIè¯·æ±‚å¤´
- **è®¤è¯æ”¯æŒ**ï¼š
  - Bearer Token è®¤è¯
  - Basic è®¤è¯
- **å˜é‡æ›¿æ¢**ï¼šæ”¯æŒ `${variable}` æ ¼å¼çš„å˜é‡æ›¿æ¢
  - ç¯å¢ƒå˜é‡
  - æµ‹è¯•ç”¨ä¾‹å˜é‡
  - æ‰§è¡Œè¿‡ç¨‹ä¸­çš„å˜é‡
- **è¯·æ±‚å‚æ•°å¤„ç†**ï¼š
  - æŸ¥è¯¢å‚æ•°ï¼ˆparamsï¼‰
  - è¯·æ±‚ä½“ï¼ˆbodyï¼‰- JSONæ ¼å¼
- **æ–­è¨€éªŒè¯**ï¼šæ”¯æŒå¤šç§æ–­è¨€ç±»å‹
  - çŠ¶æ€ç æ–­è¨€ï¼ˆstatus_codeï¼‰
  - å“åº”æ—¶é—´æ–­è¨€ï¼ˆresponse_timeï¼‰
  - åŒ…å«æ–­è¨€ï¼ˆcontainsï¼‰
  - JSONè·¯å¾„æ–­è¨€ï¼ˆjson_pathï¼‰
  - ç›¸ç­‰æ–­è¨€ï¼ˆequalsï¼‰
- **é”™è¯¯å¤„ç†**ï¼š
  - è¶…æ—¶å¤„ç†
  - è¿æ¥é”™è¯¯å¤„ç†
  - å¼‚å¸¸æ•è·

### 2. **æµ‹è¯•ç”¨ä¾‹æ‰§è¡Œæ¥å£** (`backend/apps/testcases/views.py`)

**æ¥å£è·¯å¾„**ï¼š`POST /api/testcases/testcases/{id}/execute/`

#### åŠŸèƒ½è¯´æ˜
- æ‰§è¡Œå•ä¸ªæµ‹è¯•ç”¨ä¾‹
- è‡ªåŠ¨åˆ›å»ºæ‰§è¡Œè®°å½•
- è¿”å›è¯¦ç»†çš„æ‰§è¡Œç»“æœ

#### å“åº”æ ¼å¼
```json
{
  "execution_id": 1,
  "status": "passed",
  "result": {
    "status_code": 200,
    "headers": {},
    "body": "...",
    "time": 123.45,
    "success": true,
    "assertions": [
      {
        "type": "status_code",
        "expected": 200,
        "actual": 200,
        "success": true,
        "message": "çŠ¶æ€ç æ–­è¨€: æœŸæœ› 200, å®é™… 200"
      }
    ],
    "error": null
  },
  "message": "æ‰§è¡Œå®Œæˆ"
}
```

### 3. **æµ‹è¯•å¥—ä»¶æ‰¹é‡æ‰§è¡Œæ¥å£** (`backend/apps/testsuites/views.py`)

**æ¥å£è·¯å¾„**ï¼š`POST /api/testsuites/testsuites/{id}/execute/`

#### åŠŸèƒ½è¯´æ˜
- æ‰¹é‡æ‰§è¡Œå¥—ä»¶ä¸­çš„æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹
- åˆ›å»ºå¥—ä»¶æ‰§è¡Œè®°å½•å’Œæ¯ä¸ªç”¨ä¾‹çš„æ‰§è¡Œè®°å½•
- æ±‡æ€»æ‰§è¡Œç»“æœï¼ˆæ€»æ•°ã€é€šè¿‡ã€å¤±è´¥ã€é€šè¿‡ç‡ï¼‰

#### å“åº”æ ¼å¼
```json
{
  "execution_id": 1,
  "status": "passed",
  "summary": {
    "total": 5,
    "passed": 4,
    "failed": 1,
    "pass_rate": 80.0,
    "duration": 2.5
  },
  "case_results": [
    {
      "testcase_id": 1,
      "testcase_name": "ç™»å½•æ¥å£æµ‹è¯•",
      "execution_id": 2,
      "status": "passed",
      "duration": 0.5,
      "result": {...}
    }
  ],
  "message": "å¥—ä»¶æ‰§è¡Œå®Œæˆ"
}
```

### 4. **API æ‰§è¡Œæ¥å£å®Œå–„** (`backend/apps/apis/views.py`)

**æ¥å£è·¯å¾„**ï¼š`POST /api/apis/apis/{id}/execute/`

#### åŠŸèƒ½è¯´æ˜
- æ‰§è¡Œå•ä¸ªAPIæ¥å£è¯·æ±‚
- æ”¯æŒå˜é‡æ›¿æ¢å’Œç¯å¢ƒé…ç½®
- è¿”å›å®Œæ•´çš„è¯·æ±‚å“åº”ä¿¡æ¯

#### è¯·æ±‚å‚æ•°ï¼ˆå¯é€‰ï¼‰
```json
{
  "variables": {
    "token": "xxx",
    "userId": "123"
  },
  "base_url": "https://api.example.com"
}
```

#### å“åº”æ ¼å¼
```json
{
  "status_code": 200,
  "headers": {},
  "body": "...",
  "json": {...},
  "time": 123.45,
  "url": "https://api.example.com/api/users",
  "success": true
}
```

### 5. **ç”¨æˆ·ç®¡ç†æ¥å£** (`backend/apps/users/views.py`)

#### 5.1 è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
**æ¥å£è·¯å¾„**ï¼š`GET /api/users/users/me/`

#### 5.2 ä¿®æ”¹å¯†ç 
**æ¥å£è·¯å¾„**ï¼š`POST /api/users/users/change_password/`

**è¯·æ±‚å‚æ•°**ï¼š
```json
{
  "old_password": "æ—§å¯†ç ",
  "new_password": "æ–°å¯†ç "
}
```

---

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### 1. æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹

```bash
# æ‰§è¡ŒIDä¸º1çš„æµ‹è¯•ç”¨ä¾‹
curl -X POST http://127.0.0.1:8000/api/testcases/testcases/1/execute/ \
  -H "Authorization: Token your_token" \
  -H "Content-Type: application/json"
```

### 2. æ‰§è¡Œæµ‹è¯•å¥—ä»¶

```bash
# æ‰§è¡ŒIDä¸º1çš„æµ‹è¯•å¥—ä»¶
curl -X POST http://127.0.0.1:8000/api/testsuites/testsuites/1/execute/ \
  -H "Authorization: Token your_token" \
  -H "Content-Type: application/json"
```

### 3. æ‰§è¡ŒAPIæ¥å£

```bash
# æ‰§è¡ŒIDä¸º1çš„APIæ¥å£
curl -X POST http://127.0.0.1:8000/api/apis/apis/1/execute/ \
  -H "Authorization: Token your_token" \
  -H "Content-Type: application/json" \
  -d '{
    "variables": {
      "token": "your_token"
    },
    "base_url": "https://api.example.com"
  }'
```

---

## ğŸ” æ–­è¨€é…ç½®ç¤ºä¾‹

### æ–­è¨€é…ç½®æ ¼å¼ï¼ˆJSONï¼‰

```json
[
  {
    "type": "status_code",
    "expected": 200
  },
  {
    "type": "response_time",
    "expected": 1000
  },
  {
    "type": "contains",
    "expected": "success"
  },
  {
    "type": "json_path",
    "json_path": "data.user.id",
    "value": "123"
  },
  {
    "type": "equals",
    "json_path": "code",
    "expected": 0
  }
]
```

### æ–­è¨€ç±»å‹è¯´æ˜

1. **status_code**: çŠ¶æ€ç æ–­è¨€
   - `expected`: æœŸæœ›çš„çŠ¶æ€ç 

2. **response_time**: å“åº”æ—¶é—´æ–­è¨€ï¼ˆæ¯«ç§’ï¼‰
   - `expected`: æœŸæœ›çš„æœ€å¤§å“åº”æ—¶é—´

3. **contains**: åŒ…å«æ–­è¨€
   - `expected`: æœŸæœ›åŒ…å«çš„å­—ç¬¦ä¸²

4. **json_path**: JSONè·¯å¾„æ–­è¨€
   - `json_path`: JSONè·¯å¾„ï¼ˆå¦‚ `data.user.name`ï¼‰
   - `value`: æœŸæœ›çš„å€¼

5. **equals**: ç›¸ç­‰æ–­è¨€
   - `json_path`: JSONè·¯å¾„ï¼ˆå¯é€‰ï¼Œä¸æä¾›åˆ™æ¯”è¾ƒæ•´ä¸ªå“åº”ï¼‰
   - `expected`: æœŸæœ›çš„å€¼

---

## ğŸ” è®¤è¯é…ç½®ç¤ºä¾‹

### Bearer Token è®¤è¯

åœ¨APIæ¨¡å‹ä¸­é…ç½®ï¼š
```json
{
  "auth_type": "bearer",
  "auth_config": {
    "token": "${api_token}"
  }
}
```

### Basic è®¤è¯

åœ¨APIæ¨¡å‹ä¸­é…ç½®ï¼š
```json
{
  "auth_type": "basic",
  "auth_config": {
    "username": "${username}",
    "password": "${password}"
  }
}
```

---

## ğŸŒ å˜é‡ä½¿ç”¨ç¤ºä¾‹

### ç¯å¢ƒå˜é‡é…ç½®

åœ¨ç¯å¢ƒæ¨¡å‹ä¸­é…ç½®ï¼š
```json
{
  "variables": {
    "api_token": "abc123",
    "base_url": "https://api.example.com"
  }
}
```

### æµ‹è¯•ç”¨ä¾‹å˜é‡é…ç½®

åœ¨æµ‹è¯•ç”¨ä¾‹æ¨¡å‹ä¸­é…ç½®ï¼š
```json
{
  "variables": {
    "userId": "123",
    "username": "test_user"
  }
}
```

### URLä¸­ä½¿ç”¨å˜é‡

```json
{
  "url": "/api/users/${userId}/profile"
}
```

### è¯·æ±‚ä½“ä¸­ä½¿ç”¨å˜é‡

```json
{
  "body": {
    "username": "${username}",
    "token": "${api_token}"
  }
}
```

---

## ğŸ“Š æ‰§è¡Œè®°å½•

æ‰€æœ‰æ‰§è¡Œæ“ä½œéƒ½ä¼šè‡ªåŠ¨åˆ›å»ºæ‰§è¡Œè®°å½•ï¼ˆExecutionæ¨¡å‹ï¼‰ï¼ŒåŒ…å«ï¼š

- æ‰§è¡Œåç§°
- æ‰€å±é¡¹ç›®
- å…³è”çš„æµ‹è¯•å¥—ä»¶ï¼ˆå¦‚æœ‰ï¼‰
- å…³è”çš„æµ‹è¯•ç”¨ä¾‹ï¼ˆå¦‚æœ‰ï¼‰
- æ‰§è¡Œäºº
- æ‰§è¡ŒçŠ¶æ€ï¼ˆpending/running/passed/failed/skippedï¼‰
- æ‰§è¡Œç»“æœï¼ˆJSONæ ¼å¼ï¼‰
- å¼€å§‹æ—¶é—´
- ç»“æŸæ—¶é—´
- æ‰§è¡Œæ—¶é•¿ï¼ˆç§’ï¼‰

---

## ğŸš€ ä¸‹ä¸€æ­¥è®¡åˆ’

### å·²å®Œæˆ âœ…
- [x] æµ‹è¯•ç”¨ä¾‹æ‰§è¡Œå¼•æ“
- [x] æµ‹è¯•ç”¨ä¾‹æ‰§è¡Œæ¥å£
- [x] æµ‹è¯•å¥—ä»¶æ‰¹é‡æ‰§è¡Œæ¥å£
- [x] APIæ‰§è¡Œæ¥å£å®Œå–„
- [x] ç”¨æˆ·ç®¡ç†æ¥å£

### å¾…å®ç° ğŸ”²
- [ ] å‰ç½®/åç½®è„šæœ¬æ‰§è¡Œï¼ˆç›®å‰åªæœ‰æ¡†æ¶ï¼‰
- [ ] æ›´å¤šæ–­è¨€ç±»å‹ï¼ˆæ­£åˆ™è¡¨è¾¾å¼ã€ç±»å‹æ£€æŸ¥ç­‰ï¼‰
- [ ] æ‰§è¡Œç»“æœå¯¼å‡ºï¼ˆHTML/PDFï¼‰
- [ ] å®šæ—¶ä»»åŠ¡è°ƒåº¦ï¼ˆCelery Beaté›†æˆï¼‰
- [ ] å¼‚æ­¥æ‰§è¡Œï¼ˆåå°ä»»åŠ¡ï¼‰
- [ ] æ‰§è¡Œæ—¥å¿—è®°å½•
- [ ] æ€§èƒ½ç›‘æ§å’Œç»Ÿè®¡

---

**æœ€åæ›´æ–°ï¼š2025-10-31**





