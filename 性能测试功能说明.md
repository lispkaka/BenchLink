# 性能测试功能说明

## 功能概述

BenchLink 平台提供了完整的性能测试功能，基于 Locust 实现轻量级但功能完善的性能测试方案。

## 菜单结构

性能测试功能位于左侧菜单"性能测试"下，包含4个子菜单：

### 1. 任务列表 (`/performance/tasks`)
- **功能**：查看和管理所有性能测试任务
- **主要操作**：
  - 查看任务列表（支持按项目筛选）
  - 编辑任务配置
  - 执行性能测试任务
  - 查看测试报告
  - 删除任务

### 2. 新建任务 (`/performance/tasks/create`)
- **功能**：创建或编辑性能测试任务
- **配置项**：
  - 任务名称
  - 所属项目
  - 关联接口
  - 测试环境（可选）
  - 性能参数：
    - 并发线程数（1-1000）
    - 启动时间（秒）
    - 持续时间（秒）
    - 循环次数
  - 任务描述

### 3. 脚本管理 (`/performance/scripts`)
- **功能**：管理自定义 Locust 性能测试脚本
- **特性**：
  - 创建自定义脚本
  - 编辑脚本内容
  - 查看脚本详情
  - 关联到任务（开发中）
- **脚本格式**：标准的 Locust HttpUser 类

### 4. 测试报告 (`/performance/reports`)
- **功能**：查看性能测试执行报告和历史记录
- **报告内容**：
  - 测试状态（成功/失败）
  - 性能指标：
    - 总样本数
    - 成功/失败样本数
    - 错误率
    - 吞吐量（TPS）
    - 响应时间（平均、最小、最大、中位数、P90、P95、P99）
  - 执行时间
  - 测试耗时
  - HTML 报告路径

## 核心功能

### 1. 任务管理
- ✅ 创建、编辑、删除任务
- ✅ 按项目筛选任务
- ✅ 任务配置（并发、启动时间、持续时间、循环次数）

### 2. 任务执行
- ✅ 一键执行性能测试
- ✅ 实时显示执行状态
- ✅ 自动生成测试报告

### 3. 报告查看
- ✅ 查看历史测试报告
- ✅ 详细的性能指标展示
- ✅ HTML 报告生成（Locust 自动生成）
- ✅ 按任务筛选报告

### 4. 脚本管理（开发中）
- 🔄 自定义 Locust 脚本
- 🔄 脚本版本管理
- 🔄 脚本关联任务

## 技术实现

### 后端
- **执行器**：`LocustExecutor` (`backend/apps/testcases/locust_executor.py`)
- **模型**：`PerformanceTest` (`backend/apps/testcases/models.py`)
- **API**：`PerformanceTestViewSet` (`backend/apps/testcases/views.py`)

### 前端
- **任务列表**：`PerformanceTaskList.vue`
- **新建任务**：`PerformanceTaskCreate.vue`
- **脚本管理**：`PerformanceScripts.vue`
- **测试报告**：`PerformanceReports.vue`

## 使用流程

1. **创建任务**
   - 进入"性能测试" → "新建任务"
   - 填写任务信息和性能参数
   - 保存任务

2. **执行测试**
   - 进入"性能测试" → "任务列表"
   - 点击任务的"执行"按钮
   - 等待测试完成

3. **查看报告**
   - 执行完成后自动跳转到报告页面
   - 或进入"性能测试" → "测试报告"
   - 查看详细的性能指标和 HTML 报告

## 性能指标说明

- **总样本数**：发送的总请求数
- **成功样本**：成功响应的请求数
- **失败样本**：失败或错误的请求数
- **错误率**：失败请求占总请求的百分比
- **吞吐量（TPS）**：每秒处理的请求数
- **响应时间**：
  - 平均响应时间：所有请求的平均响应时间
  - 最小/最大响应时间：最快/最慢的响应时间
  - 中位数：50% 请求的响应时间
  - P90/P95/P99：90%/95%/99% 请求的响应时间

## 注意事项

1. **环境配置**：确保测试环境的 base_url 已正确配置
2. **认证配置**：如果接口需要认证，请配置接口认证或全局 Token
3. **资源限制**：注意服务器资源，避免过度压测
4. **测试时间**：长时间压测会生成大量日志，注意磁盘空间
5. **Locust 安装**：确保已安装 Locust（`pip install locust>=2.17.0`）

## 后续计划

- [ ] 脚本管理功能完善（后端 API）
- [ ] 报告历史记录存储（独立报告模型）
- [ ] 报告导出功能
- [ ] 性能对比功能
- [ ] 定时执行性能测试
- [ ] 分布式压测支持

