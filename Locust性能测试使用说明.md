# Locust 性能测试使用说明

## 1. 安装 Locust

BenchLink 平台使用 Locust 进行性能测试。Locust 是一个轻量级的 Python 性能测试工具。

### 安装步骤

```bash
# 进入后端目录
cd backend

# 安装依赖（Locust 已在 requirements.txt 中）
pip install -r requirements.txt
```

或者单独安装 Locust：

```bash
pip install locust>=2.17.0
```

### 验证安装

```bash
locust --version
```

如果显示版本号，说明安装成功。

## 2. 使用性能测试功能

### 2.1 创建性能测试

1. 进入"性能测试" → "性能测试管理"
2. 点击"新建性能测试"
3. 填写以下信息：
   - **测试名称**：性能测试的名称
   - **所属项目**：选择关联的项目
   - **关联接口**：选择要测试的接口
   - **测试环境**：选择测试环境（可选）
   - **并发线程数**：同时运行的虚拟用户数（1-1000）
   - **启动时间(秒)**：所有线程启动完成所需的时间
   - **持续时间(秒)**：测试持续运行的时间，0 表示使用循环次数
   - **循环次数**：每个线程执行的次数，-1 表示无限循环
   - **描述**：测试描述（可选）

### 2.2 执行性能测试

1. 在性能测试列表中，点击"执行"按钮
2. 等待测试完成（测试时间取决于您设置的持续时间和循环次数）
3. 查看测试结果

### 2.3 查看测试结果

测试完成后，会显示以下指标：

- **总样本数**：总请求数
- **成功样本**：成功请求数
- **失败样本**：失败请求数
- **错误率**：失败请求占比
- **吞吐量(TPS)**：每秒请求数
- **平均响应时间**：平均响应时间（毫秒）
- **最小响应时间**：最小响应时间（毫秒）
- **最大响应时间**：最大响应时间（毫秒）
- **中位数响应时间**：50% 请求的响应时间（毫秒）
- **P90响应时间**：90% 请求的响应时间（毫秒）
- **P95响应时间**：95% 请求的响应时间（毫秒）
- **P99响应时间**：99% 请求的响应时间（毫秒）

测试结果还会生成 HTML 报告，保存在 `backend/logs/locust/result_<test_id>_<timestamp>/report.html`

## 3. Locust 特性

### 优势

- ✅ **轻量级**：纯 Python 实现，安装简单
- ✅ **代码驱动**：测试场景通过代码定义，灵活可控
- ✅ **实时监控**：支持实时查看测试进度和结果
- ✅ **分布式**：支持分布式压测（高级功能）
- ✅ **详细报告**：自动生成 HTML 报告和 CSV 数据

### 功能说明

- **并发控制**：支持精确控制并发用户数
- **启动速率**：支持逐步增加并发用户（ramp-up）
- **持续时间**：支持设置测试持续时间
- **循环次数**：支持设置每个用户的请求次数
- **结果分析**：自动计算 TPS、响应时间、错误率等指标

## 4. 注意事项

1. **环境配置**：确保测试环境的 base_url 已正确配置
2. **认证配置**：如果接口需要认证，请在接口配置中设置认证信息，或配置全局 Token
3. **资源限制**：注意服务器的资源限制，避免过度压测导致服务器崩溃
4. **网络环境**：确保网络连接稳定，避免网络问题影响测试结果
5. **测试时间**：长时间压测会生成大量日志，注意磁盘空间

## 5. 故障排查

### 问题：Locust 命令未找到

**解决方案**：
```bash
# 确保 Locust 已安装
pip install locust

# 检查环境变量
which locust
```

### 问题：测试执行失败

**可能原因**：
1. 接口 URL 配置错误
2. 环境 base_url 未配置
3. 认证信息不正确
4. 网络连接问题

**解决方案**：
1. 检查接口配置和环境配置
2. 查看测试结果中的错误信息
3. 检查后端日志：`backend/logs/backend.log`

### 问题：测试结果不准确

**可能原因**：
1. 测试时间过短
2. 并发数设置不合理
3. 服务器资源不足

**解决方案**：
1. 增加测试持续时间
2. 调整并发数和启动速率
3. 检查服务器资源使用情况

