# 参数化功能使用说明

## 功能概述

参数化功能允许您用一个测试用例定义，使用不同的参数值循环执行多次，类似于在 YAML 文件中维护测试数据表。

**重要说明**：参数化功能应该在**测试用例**中配置，而不是在接口定义中。这样可以：
- ✅ 避免接口定义与流程测试的冲突
- ✅ 同一个接口可以在不同用例中使用不同的参数化数据
- ✅ 更好地支持测试套件和流程测试

## 使用场景

**示例：测试登录接口 `/auth/user/login`，验证不同账号的登录情况，同时还要支持流程测试（登录后获取用户信息）**

## 使用场景

**示例：测试登录接口 `/auth/user/login`，验证不同账号的登录情况**

## 配置步骤

### 1. 创建接口（定义模板）

在"接口管理"页面创建登录接口：
- **接口名称**：用户登录
- **请求方法**：POST
- **接口路径**：`/auth/user/login`
- **请求体（Body）**：
```json
{
  "username": "admin",
  "password": "admin123"
}
```

💡 **注意**：接口定义中可以使用变量占位符（可选），或者使用默认值。

### 2. 创建测试用例并配置参数化

在"测试用例"页面创建用例：
- **用例名称**：登录接口-参数化测试
- **关联接口**：选择上面创建的"用户登录"接口
- **测试环境**：选择对应的环境

在用例编辑对话框中：
1. 切换到 **"参数覆盖"** 标签页，覆盖请求体（使用变量占位符）：
```json
{
  "username": "${username}",
  "password": "${password}"
}
```

2. 切换到 **"参数化配置"** 标签页：

1. **启用参数化**：选择"启用"
2. **参数化数据**：输入 JSON 数组格式的测试数据

**示例配置**：
```json
[
  {
    "username": "admin",
    "password": "admin123"
  },
  {
    "username": "user1",
    "password": "password123"
  },
  {
    "username": "test",
    "password": "test123"
  },
  {
    "username": "invalid",
    "password": "wrong"
  }
]
```

### 3. 执行参数化测试

点击接口列表的 **"执行"** 按钮，系统会：
1. 读取参数化数据数组
2. 循环执行接口，每次使用一组参数
3. 显示汇总结果和每次执行的详情

## 工作原理

### 变量替换机制

1. **定义阶段**：在接口的 URL、Headers、Params、Body 中使用 `${变量名}` 占位符
2. **执行阶段**：
   - 从参数化数据中取出一组参数（如 `{"username": "admin", "password": "admin123"}`）
   - 替换接口中的所有 `${变量名}`
   - 发送请求并记录结果
   - 继续下一组参数

### 示例详解

**接口配置**：
```json
{
  "url": "/auth/user/login",
  "method": "POST",
  "body": {
    "username": "${username}",
    "password": "${password}"
  }
}
```

**参数化数据**：
```json
[
  {"username": "admin", "password": "admin123"},
  {"username": "user1", "password": "pass123"}
]
```

**实际执行**：

第1次执行：
```json
POST /auth/user/login
{
  "username": "admin",
  "password": "admin123"
}
```

第2次执行：
```json
POST /auth/user/login
{
  "username": "user1",
  "password": "pass123"
}
```

## 与 YAML 测试数据的对比

### YAML 方式（传统）
```yaml
test_cases:
  - name: 登录测试-管理员
    request:
      username: admin
      password: admin123
  - name: 登录测试-普通用户
    request:
      username: user1
      password: pass123
```

### 平台方式（BenchLink）
```json
// 接口定义（1次）
{
  "url": "/auth/user/login",
  "body": {
    "username": "${username}",
    "password": "${password}"
  }
}

// 参数化数据（类似YAML的测试数据表）
[
  {"username": "admin", "password": "admin123"},
  {"username": "user1", "password": "pass123"}
]
```

**优势**：
- ✅ 接口定义只需写一次，数据与逻辑分离
- ✅ 数据以 JSON 格式存储，易于维护
- ✅ 支持在界面中编辑和管理
- ✅ 可以直接从 Excel/CSV 转换而来

## 高级用法

### 1. URL 参数化

如果接口路径也需要参数化：
```json
// 接口定义
{
  "url": "/users/${user_id}/profile",
  "method": "GET"
}

// 参数化数据
[
  {"user_id": "1"},
  {"user_id": "2"},
  {"user_id": "3"}
]
```

### 2. 查询参数参数化

```json
// 接口定义
{
  "url": "/api/search",
  "method": "GET",
  "params": {
    "keyword": "${keyword}",
    "page": "${page}",
    "size": "${size}"
  }
}

// 参数化数据
[
  {"keyword": "test1", "page": "1", "size": "10"},
  {"keyword": "test2", "page": "1", "size": "20"},
  {"keyword": "test3", "page": "2", "size": "10"}
]
```

### 3. 请求头参数化

```json
// 接口定义
{
  "url": "/api/data",
  "headers": {
    "Authorization": "Bearer ${token}",
    "X-User-Id": "${user_id}"
  }
}

// 参数化数据
[
  {"token": "token1", "user_id": "1"},
  {"token": "token2", "user_id": "2"}
]
```

### 4. 混合参数化（URL + Body）

```json
// 接口定义
{
  "url": "/orders/${order_id}/items",
  "method": "POST",
  "body": {
    "item_name": "${item_name}",
    "quantity": "${quantity}"
  }
}

// 参数化数据
[
  {"order_id": "1001", "item_name": "商品A", "quantity": 2},
  {"order_id": "1002", "item_name": "商品B", "quantity": 5}
]
```

## 执行结果查看

执行后会显示：
- **汇总信息**：总次数、通过数、失败数、总耗时
- **详细结果**：每次执行的请求URL、状态码、响应时间、响应内容
- **支持查看**：点击某次执行结果可以查看完整的请求/响应详情

## 注意事项

1. **变量名必须匹配**：参数化数据中的 key 必须与接口中使用的 `${变量名}` 完全一致
2. **JSON 格式正确**：参数化数据必须是有效的 JSON 数组格式
3. **数据类型**：JSON 中的值会自动转换为对应类型（字符串、数字、布尔值）
4. **执行顺序**：按数组顺序依次执行
5. **失败不影响**：某次执行失败不会中断后续执行

## 最佳实践

1. **数据准备**：先在 Excel 中准备测试数据，然后转换为 JSON
2. **命名规范**：使用有意义的变量名，如 `${username}` 而不是 `${var1}`
3. **测试覆盖**：包含正常场景、边界场景、异常场景的数据
4. **数据维护**：测试数据变化时，只需更新参数化数据，无需修改接口定义

## 常见问题

**Q: 参数化数据在哪里配置？**
A: 在接口编辑对话框的"参数化配置"标签页中配置。

**Q: 可以导入 Excel 数据吗？**
A: 目前需要手动转换为 JSON 格式，未来版本会支持 Excel 导入。

**Q: 参数化执行后能保存执行记录吗？**
A: 当前接口单独执行的结果不会保存到执行记录，建议在"测试用例"或"测试套件"中使用参数化功能，这样会保存执行记录。

**Q: 参数化数据和用例级别的变量有什么区别？**
A: 参数化数据是接口级别的，用于批量执行；用例级别的变量是单个用例的，可以用于接口依赖（从上一个接口提取变量传递给下一个）。

